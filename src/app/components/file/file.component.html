<div class="upload-file" *ngIf="userIsLoggedIn()">
  <input
    type="file"
    class="file-input"
    (change)="onFileSelected($event)"
    #fileUpload
  />

  <button
    *ngIf="!fileName; else fileSelected"
    mat-fab
    color="primary"
    class="upload-btn"
    (click)="fileUpload.click()"
  >
    <mat-icon>attach_file</mat-icon>
  </button>

  <ng-template #fileSelected>
    <mat-spinner></mat-spinner>
  </ng-template>
</div>

<mat-card class="files">
  <mat-card-header>
    <mat-card-title>Recent files</mat-card-title>
    <mat-card-subtitle
      >The files and pictures you recently uploaded</mat-card-subtitle
    >

    <button mat-button>
      <img
        class="profile-picture"
        src="{{ domain }}profile/picture/{{ userId }}"
        alt="profile-picture"
      />
    </button>
  </mat-card-header>

  <mat-card-content>
    <mat-list>
      <mat-list-item *ngFor="let file of recentFiles" class="file">
        <button mat-button (click)="openDialog(file.id)">
          <img
            class="file-thumbnail"
            src="{{ domain }}file/{{ file.id }}"
            alt="file-thumbnail"
          />
        </button>
        <h4 mat-line>{{ file.filename }}</h4>
        <p mat-line><b>Uploaded:</b> {{ convertDate(file.uploaded) }}</p>
        <a mat-line href="{{ domain }}file/{{ file.id }}" target="_blank"
          >URL</a
        >
      </mat-list-item>
    </mat-list>
  </mat-card-content>
</mat-card>

<mat-card class="files">
  <mat-card-header>
    <mat-card-title>All Files</mat-card-title>
    <mat-card-subtitle>The files you have uploaded</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <mat-form-field>
      <input
        type="tel"
        matInput
        placeholder="Search"
        name="search"
        [(ngModel)]="search"
      />
    </mat-form-field>

    <mat-button-toggle-group class='sort'>
      <mat-button-toggle (click)='sortFiles(true)' matTooltip='Sort via name' value="name"><mat-icon>sort</mat-icon></mat-button-toggle>
      <mat-button-toggle (click)='sortFiles(false)' matTooltip='Sort via date' value="date"><mat-icon>calendar_month</mat-icon></mat-button-toggle>
    </mat-button-toggle-group>

    <mat-grid-list cols="3">
      <mat-grid-tile
        *ngFor="let file of searchFiles()"
        class="file-small"
        matTooltip="{{ file.filename }}"
      >
        <button
          mat-button
          (click)="openDialog(file.id)"
          class="thumbnail-button"
        >
          <img
            class="file-thumbnail-small"
            src="{{ domain }}file/{{ file.id }}"
            alt="file-thumbnail"
          />
        </button>
      </mat-grid-tile>
    </mat-grid-list>
  </mat-card-content>
</mat-card>
