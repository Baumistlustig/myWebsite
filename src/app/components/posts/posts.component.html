<div class="posts">
  <mat-card class="post" *ngFor="let post of posts; let i = index">
    <mat-card-header>
      <mat-card-title>
        <form *ngIf="editing === post._id; else title" [formGroup]="postGroup">
          <mat-form-field>
            <input matInput formControlName="title" placeholder="Title" />
          </mat-form-field>
        </form>
        <ng-template #title>
          {{ post.title }}
        </ng-template>
      </mat-card-title>
      <mat-card-subtitle>{{ convertDate(post.created) }}</mat-card-subtitle>

      <span fxFlex></span>

      <button mat-button>
        <span class="profile-name">{{ users[i].username }}</span>
        <img
          class="profile-picture"
          src="{{ domain }}profile/picture/{{ post.authorId }}"
          alt="profile-picture"
        />
      </button>
    </mat-card-header>

    <mat-card-content class="postContent">
      <form *ngIf="editing === post._id; else content" [formGroup]="postGroup">
        <mat-form-field>
          <textarea
            matInput
            name="content"
            placeholder="Content"
            formControlName="content"
          ></textarea>
        </mat-form-field>
      </form>

      <ng-template #content>
        {{ post.content }}
      </ng-template>
    </mat-card-content>

    <mat-card-actions class="postFooter">
      <button
        *ngIf="userIsAuthor(post.authorId); else notLoggedIn1"
        mat-icon-button
        color="{{ returnVoted(post, true) }}"
        (click)="voteUp(i)"
      >
        <mat-icon>thumb_up</mat-icon>
      </button>
      {{ post.likedBy.length }}
      <button
        *ngIf="userIsAuthor(post.authorId); else notLoggedIn2"
        mat-icon-button
        color="{{ returnVoted(post, false) }}"
        (click)="voteDown(i)"
      >
        <mat-icon>thumb_down</mat-icon>
      </button>
      {{ post.dislikedBy.length }}

      <ng-template #notLoggedIn1>
        <button mat-icon-button>
          <mat-icon>thumb_up</mat-icon>
        </button>
      </ng-template>

      <ng-template #notLoggedIn2>
        <button mat-icon-button>
          <mat-icon>thumb_down</mat-icon>
        </button>
      </ng-template>

      <span fxFlex></span>

      <button
        mat-button
        *ngIf="userIsAuthor(post.authorId)"
        (click)="editing === post._id ? savePost(post) : initForm(post)"
      >
        <mat-icon>edit</mat-icon>
        {{ editing === post._id ? save : edit }}
      </button>
    </mat-card-actions>
  </mat-card>
</div>
